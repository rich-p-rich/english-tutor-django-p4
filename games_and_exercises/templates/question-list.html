{% extends 'base.html' %}

{% block content %}
<div class="container">
<h1>{{ section.title }}</h1>
<form method="post">
    {% csrf_token %}
    <ol>
        {% for question in questions %}
        <li id="{{ question.id }}">
            <p>{{ question.question_text }}</p>
            {% for choice in question.choices.all %}
            <div>
                <input type="radio" name="{{ question.id }}" value="{{ choice.id }}" id="choice{{ choice.id }}" data-correct="{{ choice.is_correct|yesno:'true,false' }}">
                <label for="choice{{ choice.id }}">{{ choice.choice_text }}</label>
            </div>
            {% endfor %}
            <div class="feedback"></div>
        </li>
        {% endfor %}
    </ol>
    <button type="submit">Submit</button>
</form>

{% if user_answers %}
    <h2>Results</h2>
    <ol>
        {% for question in questions %}
        <li>
            <p>{{ question.question_text }}</p>
            {% if question.id in user_answers %}
                {% with answer=user_answers|default_if_none:None %}
                    {% if answer and answer.selected %}
                        {% if answer.correct %}
                        <p style="color: green;">Correct! You chose: {{ answer.selected.choice_text }}</p>
                        {% else %}
                        <p style="color: red;">Incorrect. You chose: {{ answer.selected.choice_text }}</p>
                        {% endif %}
                    {% else %}
                        <p style="color: orange;">Please select an answer.</p>
                    {% endif %}
                    <p>The correct answer is: 
                        {% for choice in question.choices.all %}
                            {% if choice.is_correct %}
                                {{ choice.choice_text }}
                            {% endif %}
                        {% endfor %}
                    </p>
                {% endwith %}
            {% endif %}
        </li>
        {% endfor %}
    </ol>
</div>
{% endif %}
{% endblock %}
